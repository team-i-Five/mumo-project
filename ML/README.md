# Machine-learning

## 추천 기준
- **CASE 1** : 처음 뮤지컬을 접한 사용자가 태그를 이용하여 작품 선택, 해당 작품과 유사한 뮤지컬 추천 
- **CASE 2** : 뮤지컬 경험이 있는 사용자가 봤던 작품 선택, 해당 작품과 유사한 뮤지컬 추천 \

**→ 선택한 과거 뮤지컬 작품 줄거리와 현재 상영 중, 상영 예정인 뮤지컬 작품 줄거리의 유사도를 기준으로 추천**

---
## 1. Data
**결측치 처리, 텍스트 전처리, 워드 임베딩, 태깅 완료된 데이터셋**
> 기준 : 2023.11.14
- 과거 상영작 : `past_final.csv`
- 현재 상영작 : `present_final.csv`
- 상영 예정작 : `future_final.csv`
---
## 2. Data_preprocessing
**전처리 대상 : past, present, future 뮤지컬 정보 데이터**

**[ 데이터 전처리 ]**
- `결측치 처리` : poster url, date, actors를 제외한 모든 열에 대해 특수 문자와 HTML Entity 코드 제거
- `텍스트 전처리` : Konlpy를 사용하여 줄거리 텍스트를 단어로 나누고 품사를 붙여서 리턴, 품사가 명사 또는 형용사일 경우에만 단어들을 문자열로 만들어서 리턴
- `워드 임베딩` : Word2Vec의 Skip-gram을 사용하여 줄거리 벡터화
- `태깅` : 줄거리 기반 단어의 빈도수를 기준으로 태그 선정 및 범주화 후 유사도에 따른 작품당 3개의 태그 저장

**[ 태그 선정 과정 ]**

① word2vec 줄거리 벡터화(학습)\
② 줄거리에서 단어의 빈도수로 태그 선정 (배열 저장)\
③ 태그와 가장 유사한 단어 1000개 key로 범주화\
④ 각 작품의 줄거리와 유사한 단어가 있는 경우, 유사도 높은 순으로 태그 3개 부여

→ **최종 태그 : 11개** (사랑, 오페라, 가족, 친구, 예술, 판타지, 휴머니즘, 역사, 공포, 코미디, 슬픔)

---
## 3. Model_test
**3가지의 모델 학습 진행함** : `KNN`(유클리디안 유사도), `SVD`(코사인 유사도), `NMF`(코사인 유사도)

|                  Model                  | Top 5 평균 유사도(기준 작품 : 실연남녀) |
|:--------------------------------------:|:---------------------------------------:|
|                 KNN                    |                 0.5226                  |
|                 SVD                    |                 0.8384                  |
|                 NMF                    |                 0.9675                  |

**→ 최종 추천 모델 : NMF (Non-negative matrix factorization)**

**[ 추천 생성 과정 ]**

① 선택한 작품의 뮤지컬 ID를 기반으로 해당 작품의 인덱스를 찾음\
② 과거 상영작 데이터와 현재 상영작 & 상영 예정작 데이터의 시놉시스와 관련된 데이터를 파싱하고  StandardScaler를 사용하여 스케일링\
③ NMF 모델을 특정 파라미터로 초기화, 스케일링된 과거 상영작 데이터와 현재 상영작 & 상영 예정작 데이터에서 특성 행렬(V)을 생성하고, NMF 모델을 이용하여 훈련\
④ 훈련된 NMF 모델을 사용하여 현재 상영작 & 상영 예정작 데이터를 변환\
⑤ 변환된 현재 상영작 & 상영 예정작과 선택한 작품 간의 코사인 유사도를 계산\
⑥ 유사도를 내림차순으로 정렬하고, 선택한 작품과 가장 유사한 상위 5개의 작품을 추출하여 추천 목록 생성

---
## 4. Fast_API
**모델링 후 추천 데이터 웹서버에 전달 위해 FAST API로 매핑, 전달 확인 후 AWS로 배포**

**[ 배포 과정 ]**

① FAST API 기본 구조를 활용하여 모델 학습 과정 추가\
② 학습된 모델 저장 및 가중치 값만 저장 (로딩 최적화)\
③ 설치 파일과 도커 파일 작성\
④ FileZilla 사용하여 AWS에 폴더 업로드\
⑤ putty 사용하여 AWS EC2에 접속 후 Docker 실행 자동화하여 추천 서비스 배포

